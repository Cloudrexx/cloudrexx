<!-- BEGIN showWebsiteInfo -->
<div  class="grid-elm grid-align-1-1 grid-offset">
  <h2>{TXT_MULTISITE_WEBSITE_MANAGEMENT}</h2>
  <!-- BEGIN showWebsiteViewButton -->
  <button type="button" class="websiteView" onclick="window.open('{MULTISITE_WEBSITE_FRONTEND_LINK}', '_blank').focus();">{TXT_MULTISITE_WEBSITE_BUTTON_VIEW}</button>
  <!-- END showWebsiteViewButton -->
  <!-- BEGIN showAdminButton -->
  <button type="button" data-id="{MULTISITE_WEBSITE_ID}" class = "websiteAdminConsole" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}" onclick="getRemoteLoginToken(jQuery(this));">{TXT_MULTISITE_WEBSITE_BUTTON_ADMIN_CONSOLE}</button>
  <!-- END showAdminButton -->
  <button type="button" class ="website_status website_deactivate" data-status="offline" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}" onclick="changeWebsiteStatus(jQuery(this));">{TXT_MULTISITE_WEBSITE_BUTTON_DEACTIVATE}</button>
  <button type="button" class ="website_status website_activate" data-status="online" data-loading-text="<img src='/lib/javascript/jquery/jstree/themes/default/throbber.gif' /> {TXT_CORE_MODULE_MULTISITE_LOADING_TEXT}"  onclick="changeWebsiteStatus(jQuery(this));">{TXT_CORE_MODULE_MULTISITE_WEBSITE_BUTTON_ACTIVATE}</button>
  <button type="button"  data-target="#WebsiteDelete" data-toggle="modal">{TXT_MULTISITE_WEBSITE_BUTTON_DELETE}</button>
  <button data-remote="/api/MultiSite/CopyWebsite?id={MULTISITE_WEBSITE_ID}" onClick="copyWebsite(jQuery(this))">{TXT_MULTISITE_WEBSITE_COPY}</button>
  <!-- BEGIN showUpgradeButton -->
  <button class="upgrade remoteModal" data-remote="/api/MultiSite/SubscriptionSelection?id={MULTISITE_WEBSITE_ID}&subscriptionId={MULTISITE_SUBSCRIPTION_ID}" data-target="SubscriptionSelection">{TXT_MULTISITE_UPGRADE}</button>
  <!-- END showUpgradeButton -->
  <div aria-hidden="true" class="modal fade" id="WebsiteDelete" role="dialog" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="grid-elm grid-align-1-1 grid-offset">
            <div class="row">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>

              <h2>{TXT_CORE_MODULE_MULTISITE_WEBSITE_DELETE_TITLE}</h2>

              <div class="grid-offset-bottom">
                {TXT_CORE_MODULE_MULTISITE_WEBSITE_DELETE_CONFIRM_ALERT}
              </div>

              <button type="submit" class="save"  onclick="deleteWebsite();">{TXT_MULTISITE_WEBSITE_BUTTON_DELETE}</button>
              <button type="button" class="" data-dismiss="modal">{TXT_CORE_MODULE_MULTISITE_CANCEL}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
/* <![CDATA[ */
    var websiteStatusUrl;
    var websiteDeleteUrl;
    var cadminPath;
    cx.ready(function() {
        cadminPath      = cx.variables.get('cadminPath', 'contrexx');
        websiteStatusUrl = cadminPath + 'index.php&cmd=JsonData&object=MultiSite&act=updateOwnWebsiteState';
        websiteDeleteUrl = cadminPath + 'index.php&cmd=JsonData&object=MultiSite&act=destroyWebsite';
        if (jQuery('.websiteView').length > 0) {
          jQuery('.website_activate').hide();
        } else {
            jQuery('.website_deactivate').hide();
        }
    });
    
    function deleteWebsite() {
        jQuery.ajax({
            dataType: 'json',
            url: websiteDeleteUrl,
            data: {websiteId: '{MULTISITE_WEBSITE_ID}' },
            type: 'POST',
            beforeSend: function() {
                text = '<span>{TXT_CORE_MODULE_MULTISITE_WEBSITE_DELETE_LOADING_ANIMATION}</span> <img src="{MULTISITE_PATH}/lib/javascript/jquery/jstree/themes/default/throbber.gif" />';
                jQuery('#WebsiteDelete').find('.modal-content .modal-body').html(text);
            },
            success: function(data) {
               message = (data.status == 'success') ? '{TXT_CORE_MODULE_MULTISITE_WEBSITE_DELETE_STATUS_SUCCESS_MSG}' :                
                                        '{TXT_CORE_MODULE_MULTISITE_WEBSITE_DELETE_STATUS_ERROR_MSG}';
                
                jQuery('#WebsiteDelete').on('hidden.bs.modal', function () {
                    showMessage(message, data.status);//show status message 
                });
                jQuery('#WebsiteDelete').modal('hide');
                window.location.replace('{MULTISITE_WEBSITE_DELETE_REDIRECT_URL}');
            },
            fail: function(data) {}
        });
    }
    
    function changeWebsiteStatus ($this) {
      var buttonStatus = ($this.data('status') == 'offline') ? true : false;
        jQuery.ajax({
          dataType: 'json',
          url     : websiteStatusUrl,
          data: { websiteId : '{MULTISITE_WEBSITE_ID}'},
          type: 'POST',
          beforeSend: function () {
            $this.button('loading');
            $this.prop('disabled', true);
          },
          success: function(response) {
            if (response.status == 'success') {
                var resp = response.data;
                if(resp.status == 'success') {
                  jQuery('.website_status').show();
                  $this.hide();
                  jQuery('.websiteView').prop('disabled', buttonStatus);
                  jQuery('.websiteAdminConsole').prop('disabled', buttonStatus);
                  showMessage(resp.message, 'success');
                } else {
                  showMessage(resp.message, 'success');
                }
            } else {
                showMessage(response.message, 'error');
            }
          },
        complete: function () {
            $this.button('reset');
            $this.prop('disabled', false);
        },
        error: function() { }
        });
      
    }    
/* ]]> */
</script>
<!-- END showWebsiteInfo -->
